{
  "hash": "9086575f73e6844a604780e02ba4cb70",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Placing silhouettes inside plots (ggplot2) using rphylopic\"\nimage: rphylopic.png\nauthor: \"Gabriela Palomo-Munoz\"\ndate: \"2023-03-29\"\ncategories: [ggplot2, rphylopic, silhouettes]\n# draft: true\n---\n\n\n## The rphylopic package\n\n'rphylopic' is one of my most used r packages. It basically allows users to look for silhouettes that are freely available in [phylopic.org](www.phylopic.org) and place them on any graph created in either base R or ggplot2. You can also use these silhouettes on maps or other plots, **but here I will show you how to use rphylopic with ggplot2.**\n\nThe documentation for phylopic is available [here](https://github.com/palaeoverse-community/rphylopic). This package is not new, it was created by Scott Chamberlain in 2018. *Fun fact*, I designed the original [cheatsheet](https://github.com/rstudio/cheatsheets/blob/main/rphylopic.pdf) for this package back in 2019. Now it's maintained by William Gearty and Lewis A Jones from the [Paleoverse](https://rphylopic.palaeoverse.org/) team.\n\n## What is phylopic?\n\nPhylopic is this amazing website created by Mike Keesey where digital artists (like me!) upload their silhouettes representing a taxonomic category. Usually, they represent a species, but sometimes you also have silhouettes for a family or a genus. If you find yourself using a lot of silhouettes for your work, I highly encourage you to donate to his [patreon](https://www.patreon.com/tmkeesey). I have done so in the past. Oh and be sure to follow [Mike](https://twitter.com/tmkeesey) and [phylopic](https://twitter.com/PhyloPic) on twitter or mastodon too.\n\n## rphylopic and ggplot2\n\nFirst we will start by installing 'rphylopic':\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Stable version from CRAN\ninstall.packages('rphylopic')\n\n# Development version from github\n# install.packages('devtools')\ndevtools::install_github('palaeoverse-community/rphylopic')\n```\n:::\n\n\nThen we load the following packages and dataset that we will use:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(rphylopic)\nlibrary(dplyr)\n# We will use the tree dataset \ndata(\"trees\")\n```\n:::\n\n\n### Let's start with a simple plot \n\nThe trees dataset provides measurements of diameter, height, and volume of timber in 31 felled black cherry trees. The diameter is labled as girth in the dataset so let's start by renaming it to diameter.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntrees <- trees %>% \n  rename(Diameter = Girth) # new name = old name\n\n# Let's check that it worked \nnames(trees)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Diameter\" \"Height\"   \"Volume\"  \n```\n\n\n:::\n:::\n\n\nNow let's fit a linear regression between Diameter and Volume. This is just a silly example just to have a graph on which we can plot a silhouette.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(trees,aes(Diameter, Volume)) +\n  geom_point() +\n  geom_smooth(method='lm', formula = y~x) +\n  theme_classic()+\n  theme(axis.title = element_text(face = 'bold', size = 16),\n        axis.text = element_text(size = 14)) -> ourplot\nourplot \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n### Now let's put a silhouette on that plot!\n\nLet's start by checking if we have silhouettes for the species we want. In this case a black cherry tree which is *Prunus serotina*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbct <- pick_phylopic(name = 'Prunus serotina')\n```\n:::\n\n\n[ Error in get_uuid(name = name, n = n, url = FALSE) : Image resource not available for `name`. Ensure provided name is a valid taxonomic name or try a species/genus resolution name. ]{style=\"color:red;\"}\n\nWe got an error saying there are no available silhouettes for this species (*note to self, we should draw this and upload it asap!*). So let's check another one that looks like our black cherry trees. How about Flowering Dogwood, *Cornus florida*. It's not the same species obviously but the silhouette could represent either tree. Not ideal but for this example I suppose it's ok.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbct <- pick_phylopic(name='Cornus florida')\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in get_uuid(name = name, n = n, filter = filter, url = FALSE): Only 1\nitem(s) are available.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThis is the only image. Returning this uuid data.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"8b16a223-4e27-4ce5-83a4-904b86287d49\"\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nIt shows a warning saying we only have one silhouette for this species. Sometimes, you get a species with more than one silhouette but you can see them all by typing 1 on the console when prompted. See my [tweet here for an example on how to do this](https://twitter.com/gabbspalomo/status/1639645295209267201?s=20).\n\nNow back to our plot. Let's add a silhouette. To know where to place it, think of the arguments x and y as coordinates on your graph, and the silhouette as a point you want to place in the plot. So here, I wanted it on the lower left part of the plot, which corresponds with x=20 and y = 10. The center of the silhouette will be placed on that point. The ysize argument controls how tall the silhouette will be, and is in relation to the y-axis scale.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nourplot +\n  add_phylopic(img = bct, # silhouette \n               x=20, # based on x axis coordinates\n               y=10, # based on y axis coordinates \n               ysize = 20) -> ourplot \nourplot\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n### Let's put the silhouette next to a legend \n\nNow because we want the silhouette outside the plot, we must set the coordinates to negative. In this case, the legend is at the bottom so we set the y-axis coordinates to -20. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(trees,aes(Diameter, Volume)) +\n  geom_point() +\n  geom_smooth(method='lm', formula = y~x, aes(color = 'lm')) +\n  scale_color_manual(name = 'Legend', values = 'blue')+\n  theme_classic()+\n  theme(axis.title = element_text(face = 'bold', size = 16),\n        axis.text = element_text(size = 14),\n        legend.position = 'bottom',\n      # The backgroun of the legend set to transparent because it \n      # overlaps the silhouette\n        legend.background = element_rect(fill=\"transparent\"))+\n  add_phylopic(img = bct, # silhouette \n               x=13, # based on x axis coordinates\n      # The y must be set to negative so it's outside the plot\n               y=-19, # based on y axis coordinates \n               ysize = 8) -> ourplot_legend \nourplot_legend\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n### More than one silhouette on the plot \n\nIf you want to add more than one silhouette, then just use the 'add_phylopic()' function again. I re-used the same silhouette, but you could use another one here.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nourplot +\n  add_phylopic(img = bct, # First silhouette \n               x=20, # based on x axis coordinates\n               y=10, # based on y axis coordinates \n               ysize = 20)+ # based on y axis coordinates \n  add_phylopic(img=bct, # Second silhouette \n               x=10, \n               y=70, \n               ysize = 30)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### Points as silhouettes \n\nIf you wanted the points to be little trees instead of points, then you can do so like this. I personally don't like plots like this but I am showing you it's possible:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(trees,\n       aes(Diameter, Volume)) +\n    geom_point() +\n    geom_smooth(method='lm', formula = y~x) +\n    theme_classic()+\n    theme(axis.title = element_text(face = 'bold', size = 16),\n          axis.text = element_text(size = 14)) -> plot2\n\nfor(i in 1:nrow(trees)){\n    plot2 <-  plot2 + # These two names must match \n    add_phylopic(img = bct, \n                 x = trees$Diameter[i],\n                 y = trees$Volume[i], \n                 ysize = 5)\n}\n\nplot2\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n### Let's not forget the attribution \n\nNow let's not forget to add the attribution of the silhouette to the plot! You can also add the attribution in the caption or in the acknowledgment section of a publication.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nuuid_bct <- get_uuid(name = 'Cornus florida')\nget_attribution(uuid_bct)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$contributor\n[1] \"Gabriela Palomo-Munoz\"\n\n$contributor_uuid\n[1] \"f57cf3c4-210c-4bcf-a759-9fcbc0cd8ba1\"\n\n$created\n[1] \"2022-08-13\"\n\n$contact\n[1] \"gabriella.palomo@gmail.com\"\n\n$image_uuid\n[1] \"8b16a223-4e27-4ce5-83a4-904b86287d49\"\n\n$license\n[1] \"https://creativecommons.org/licenses/by/4.0/\"\n\n$license_abbr\n[1] \"CC BY 4.0\"\n```\n\n\n:::\n:::\n\n\n## Final graph!\n\n\n::: {.cell}\n\n```{.r .cell-code}\natt <- get_attribution(uuid_bct)$contributor \n\nourplot +\n  labs(caption = paste0('Silhouette available in phylopic.org, designed by ', att))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nAnd don't forget to cite rphylopic too:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncitation(\"rphylopic\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nTo cite rphylopic in publications, use the following citation:\n\n  Gearty, W. and Jones, L.A. 2023. rphylopic: An R package for\n  fetching, transforming, and visualising PhyloPic silhouettes. Methods\n  in Ecology and Evolution, 14(11), 2700-2708. doi:\n  10.1111/2041-210X.14221.\n\nA BibTeX entry for LaTeX users is\n\n  @Article{,\n    title = {rphylopic: An R package for fetching, transforming, and visualising PhyloPic silhouettes},\n    author = {William Gearty and Lewis A. Jones},\n    year = {2023},\n    volume = {14},\n    number = {11},\n    pages = {2700-2708},\n    journal = {Methods in Ecology and Evolution},\n    doi = {10.1111/2041-210X.14221},\n  }\n```\n\n\n:::\n:::\n\n\nAnd that's it, that's all I have for now. I will do another blog post with an example in base R and a map.\n\n[Gabby]{style=\"color:deepskyblue4;font-size:40px;\"} \n\n:::{.callout-note title='How to save silhouettes'}\nif you want to save the silhouette in a specific directory then use the function 'save_phylopic(img = bct, path = './bct.png', bg = 'transparent')'.\n\nThe bg argument is so that the silhouette is saved using a transparent bakcground and not a white one which would appear on your plot as a white square every time you wanted to insert the saved silhouette into a graph. \n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}