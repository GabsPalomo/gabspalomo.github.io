{
  "hash": "df89a96ec804661b21817b9b3e05e052",
  "result": {
    "markdown": "---\ntitle: \"Include attributions of phylopic silhouettes in the caption of a plot\"\nimage: plot_caption.png\nauthor: \"Gabriela Palomo-Munoz\"\ndate: \"2023-09-18\"\ncategories: [ggplot2, rphylopic, silhouettes]\n# draft: true\n---\n\n\n## The rphylopic package\n\nI explained a little of what phylopic and the rphylopic package are [here](https://gabspalomo.github.io/blog/rphylopic_ggplot2/). I wanted to continue this series with explaining how to use this versatile package but this time creating a workflow to include the attribution of several silhouettes in the caption of a figure created using ggplot2.\n\n## The problem\n\nThe [rphylopic](https://cran.r-project.org/web/packages/rphylopic/vignettes/a-getting-started.html) package has a function to retrieve the attribution information from a silhouette: `get_attribution(uuid=uuid)`. However, if you have several silhouettes you might want to automate the code to retrieve all the attributions in one step instead of for each silhouette. I came up with this workflow, which I hope will be useful to some:\n\n## Base plot using ggplot2 \n\nLet's start by creating a simple plot to use as an example. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# packages\nlibrary(rphylopic)\nlibrary(ggplot2)\nlibrary(palmerpenguins)\nlibrary(dplyr)\n\n## Basic plot \npenguins %>% \n  filter(species %in% c('Adelie', 'Gentoo')) %>% \n  ggplot(aes(x=body_mass_g, y=bill_length_mm, color=species))+\n  geom_point(alpha=0.6)+\n  geom_smooth(method = \"lm\", se = FALSE) +\n  scale_color_manual(values = c(\"#6495ED\", \"#FFA54F\"))+\n  xlab('Body mass (g)')+\n  ylab('Bill length (mm)')+\n  theme_classic()+\n  theme(legend.position = 'top',\n        legend.title = element_blank(),\n        legend.text = element_text(size=14),\n        axis.text = element_text(size=14),\n        axis.title = element_text(size=16)) -> plot1\n\nplot1\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n\n## Now we add the silhouettes to the plot \n\nNow that we have the basic plot let's work on finding out which silhouettes we want to use. Sometimes a species may have more than one silhouette so we have to identify which specific silhouette we want and retrieve that specific uuid.\n\nThe species \n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Let's get the uuid numbers for our species of interest \ngentoo <- c('Pygoscelis papua')\nadelie <- c('Pygoscelis adeliae')\n\n# For example, the gentoo penguin has two silhouettes, let's select the\n# second one. Notice that you have to make the selection in the console.\n# The silhouettes appear in the plots panel.\n\n#pick_phylopic(gentoo) # 2 silhouettes \n#pick_phylopic(adelie) # 1 silhouette \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Now let's get the uuid for each species, notice that we have to \n# indicate the number of available silhouettes using n and \n# the one we choose using square brackets\ngp <- get_uuid('Pygoscelis papua', n=2)[2]\nap <- get_uuid('Pygoscelis adeliae')\n\n## Let's put the silhouettes that we will use in the environment\ngent <- get_phylopic(gp)\nadel <- get_phylopic(ap)\n\n## Now we add the silhouettes to our basic plot \nplot1+\n  add_phylopic(img = gent, x=3000, y=42, ysize=3)+\n  add_phylopic(img = adel, x=6200, y=55, ysize = 3)->plot1\n\nplot1\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n## Now we add the attribution in the caption of the plot \n\nNow that we have the basic plot, we want to add the attribution programmatically so we don't have to retrieve the information of each silhouette one by one. We want to be able to add the attribution easily. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Let's create a list with the species we had already defined earlier\nspp <- list(gentoo = gentoo, \n            adelie = adelie)\n\n## Now let's put the uuid of all our species in a list \nuuid_list <- list(gentoo = gp, \n                  adelie = ap) \n\n## We create an empty list where we will put the attributions of each species \natt_cont <- vector('list', length = length(spp))\nnames(att_cont) <- names(uuid_list)\n\n# Now the contributor. You might select to include more fields, but I only used contributor. Check other fields available using the $\nfor (i in 1:length(spp)){\n  att_cont[[i]] <- get_attribution(uuid = uuid_list[[i]])\n  att_cont[[i]] <- paste0(spp[[i]], ', ', att_cont[[i]]$contributor)\n}\n\n#Now let's collapse species and contributors into one single string\nsp_att <- paste(unlist(att_cont), collapse='; ')\n\n# Notice that we are using \\n to indicate a break in line\nplot1+\n  ## Notice that I am including the theme for the caption here!! \n  theme(plot.caption=element_text(face='italic', \n                                  size = 12, \n                                  vjust = -3), \n        plot.margin = margin(0, 0.5, 1, 0.5, 'cm'))+ \n  labs(caption = paste0('Attribution: ', sp_att, '\\n Silhouettes obtained from phylopic.org by Mike Keessey.')) ->plot_caption\n\nplot_caption\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n\n::: {.callout-tip}\n## Long captions \n\nUsing the package `cowplot` you can also add a caption with the info we saved in the sp_att object.   \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cowplot)\n## Let's add a subtitle using cowplot \nggdraw(add_sub(plot1,\n               size=12, \n               fontface = 'italic',\n               color='gray20',\n               x = 1, hjust = 1, # right aligned \n               paste0('Attribution: ', sp_att, '\\n Silhouettes obtained from phylopic.org by Mike Keessey.')))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n:::\n\n## Cite rphylopic in your manuscript or work:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncitation('rphylopic')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nTo cite rphylopic in publications, use the following citation:\n\n  Gearty, W. and Jones, L.A., 2023. rphylopic: An R package for\n  fetching, transforming, and visualising PhyloPic silhouettes.\n  bioRxiv. doi: 10.1101/2023.06.22.546191.\n\nA BibTeX entry for LaTeX users is\n\n  @Article{,\n    title = {rphylopic: An R package for fetching, transforming, and visualising PhyloPic silhouettes},\n    author = {William Gearty and Lewis A. Jones},\n    year = {2023},\n    journal = {bioRxiv},\n    doi = {10.1101/2023.06.22.546191},\n  }\n```\n:::\n:::\n\n\nAnd that's it, that's all I have for you. If you have any questions don't hesitate to [contact me](https://gabspalomo.github.io/).\n\n[Gabby]{style=\"color:deepskyblue4;font-size:40px;\"} \n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}